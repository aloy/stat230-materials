---
title: "Categorical Predictor Variables"
format: html
engine: knitr
editor: source
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
library(ggformula)
library(ggeffects)
library(Sleuth3)

graph_paper <- ggplot(data = data.frame(x = 0:20, y = 0:20), aes(x, y)) +
  theme_classic() +
  scale_x_continuous(name = "Age", breaks = seq(0, 20, by = 2), expand = c(0, 0)) +
  scale_y_continuous(name = "FEV", breaks = seq(0, 20, by = 2), expand = c(0, 0)) +
  theme(  
    panel.grid.major = element_line(color = "gray30", size = 0.5), # Major grid lines
    panel.grid.minor = element_line(color = "gray30", size = 0.25), # Minor grid lines
    panel.background = element_rect(fill = "white") # White background
  )
  

base <- ggplot(data = NULL) +
  scale_x_continuous(limits = c(0, 10), expand = c(0, 0), breaks = seq(0, 10, by = 2)) +
  scale_y_continuous(limits = c(0, 10), expand = c(0, 0), breaks = seq(0, 10, by = 2)) +
  scale_color_manual("Education", breaks = c("College", "Some college", "HS")) +
  theme_classic() +
  labs(x = "Age", y = "Depression score")

model1 <- base + 
    geom_abline(slope = 0.6, intercept = 1,  linetype = 3, linewidth = 1) +
  geom_abline(slope = 0.6, intercept = 2,  linetype = 2, linewidth = 1) +
  geom_abline(slope = 0.6, intercept = 3, linetype = 1, linewidth = 1, linewidth = 1) 

model2 <- base + 
    geom_abline(slope = 0.4, intercept = 1, linetype = 3, linewidth = 1) +
  geom_abline(slope = 0.6, intercept = 1, linetype = 2, linewidth = 1) +
  geom_abline(slope = 0.8, intercept = 1, linetype = 1, linewidth = 1, linewidth = 1) 


model3 <- base + 
    geom_abline(slope = 0.1, intercept = 1.5, linetype = 3, linewidth = 1) +
  geom_abline(slope = 0.6, intercept = 2,  linetype = 2, linewidth = 1) +
  geom_abline(slope = 0.4, intercept = 3, linetype = 1, linewidth = 1, linewidth = 1) 

```


## Example 1

For each regression model, sketch the fitted model. To do this, first write the expression for the fitted model for smokers and the fitted model for non-smokers (e.g., plug in 0 and 1 for the indicator variable). Once you have these two equations, use them to sketch the lines on the provided graph.


**Model 1:** $\widehat{\mu}(y|x) = 10 +  1 \mathtt{age} -2 \mathtt{smoker}$

::: {.callout-note  collapse="true"}
### Solution

Fitted equation for non-smokers: $\widehat{\mu}(y|x) = 10 +  1 \mathtt{age}$

<br>

Fitted equation for smokers: $\widehat{\mu}(y|x) = 8 +  1 \mathtt{age}$

<br>


```{r}
#| warning: false
#| fig-align: center
#| fig-asp: 1
#| fig-width: 4
#| out-width: 60%
#| echo: false
graph_paper + 
  geom_abline(intercept = 10, slope = 1, linetype = 1) +
  geom_abline(intercept = 8, slope = 1, linetype = 2) +
  theme_classic() +
  scale_x_continuous(breaks = seq(2, 20, by = 2), expand = c(0, 0), limits = c(0, 20)) +
  scale_y_continuous(breaks = seq(2, 20, by = 2), expand = c(0, 0), limits = c(0, 20)) +
  labs(x = "Age", y = "FEV")
```

:::



**Model 2:** $\widehat{\mu}(y|x) = 5 +  1 \mathtt{age} -0.5 \mathtt{age \times smoker}$


:::{.callout-note collapse="true"}
### Solution

Fitted equation for non-smokers: $\widehat{\mu}(y|x) = 5 +  1 \mathtt{age}$

Fitted equation for smokers: $\widehat{\mu}(y|x) = 5 + 0.5 \mathtt{age}$

<br>

```{r}
#| fig-align: center
#| warning: false
#| fig-asp: 1
#| fig-width: 4
#| out-width: 60%
#| echo: false
graph_paper + 
  geom_abline(intercept = 5, slope = 1, linetype = 1) +
  geom_abline(intercept = 5, slope = 0.5, linetype = 2) +
  theme_classic() +
  scale_x_continuous(breaks = seq(2, 20, by = 2), expand = c(0, 0), limits = c(0, 20)) +
  scale_y_continuous(breaks = seq(2, 20, by = 2), expand = c(0, 0), limits = c(0, 20)) +
  labs(x = "Age", y = "FEV")
```

:::


**Model 3:** $\widehat{\mu}(y|x) = 4  +  0.5 \mathtt{age} + 3\mathtt{smoker} -0.5 \mathtt{age \times smoker}$



:::{.callout-note collapse="true"}
### Solution

Fitted equation for non-smokers: $\widehat{\mu}(y|x) = 4  +  0.5 \mathtt{age}$

<br>

Fitted equation for smokers: $\widehat{\mu}(y|x) = 7  +  0 \mathtt{age}$

<br>

```{r}
#| fig-align: center
#| warning: false
#| fig-asp: 1
#| fig-width: 4
#| out-width: 60%
#| echo: false
graph_paper + 
  geom_abline(intercept = 4, slope = 0.5, linetype = 1) +
  geom_abline(intercept = 7, slope = 0, linetype = 2) +
  theme_classic() +
  scale_x_continuous(breaks = seq(2, 20, by = 2), expand = c(0, 0), limits = c(0, 20)) +
  scale_y_continuous(breaks = seq(2, 20, by = 2), expand = c(0, 0), limits = c(0, 20)) +
  labs(x = "Age", y = "FEV")
```
:::



## Example 2


Researchers investigated the association of depression with age and education, based on a nationwide (U.S.) telephone survey of 2,031 adults aged 18 to 90. Of particular interest was their finding that the association of depression with education strengthens with increasing age---a phenomenon they called the "divergence hypothesis."

The researchers constructed a depression score from responses to several related questions. Education was categorized as (i) college degree, (ii) high school degree plus some college, or (iii) high school degree only. 


1. Define indicator variables that represents the `education` category. (Start by determining wow many indicators do you need. Then define them.)

::: {.callout-note collapse="true"}
### Solution
We need two indicator variables to represent the three categories of education. We can define them as follows:
- Let $\mathtt{edu1} = 1$ if the individual has a college degree, and 0 otherwise.
- Let $\mathtt{edu2} = 1$ if the individual has a high school degree plus some college, and 0 otherwise.
- The reference category (when both $\mathtt{edu1}$ and $\mathtt{edu2}$ are 0) is having a high school degree only.

You could have chosen other baseline categories, but you need two indicators to represent three categories.
:::

2. Suppose that one researcher wants to fit a model that represents the below sketch (note that the line type represent education). Carefully write the mean function for the regression model that you should fit.

```{r}
#| echo: false
#| warning: false
#| fig-asp: 1
#| fig-width: 4
#| out-width: 60%
model1
```

:::{.callout-note collapse="true"}
### Solution
$\widehat{\mu}(y|x) = \beta_0 + \beta_1 \mathtt{age} + \beta_2 \mathtt{edu1} + \beta_3 \mathtt{edu2}$
:::


3. Suppose that one researcher wants to fit a model that represents the below sketch  (note that the line type represent education). Carefully write the mean function for the regression model that you should fit.

```{r}
#| echo: false
#| warning: false
#| fig-asp: 1
#| fig-width: 4
#| out-width: 60%
model2
```

:::{.callout-note collapse="true"}
### Solution
$\widehat{\mu}(y|x) = \beta_0 + \beta_1 \mathtt{age} + \beta_2 \mathtt{age \times edu1} + \beta_3 \mathtt{age \times edu2}$
:::


4. Suppose that one researcher wants to fit a model that represents the below sketch  (note that the line type represent education). Carefully write the mean function for the regression model that you should fit.

```{r}
#| echo: false
#| warning: false
#| fig-asp: 1
#| fig-width: 4
#| out-width: 60%
model3
```


:::{.callout-note collapse="true"}
### Solution
$\widehat{\mu}(y|x) = \beta_0 + \beta_1 \mathtt{age} + \beta_2 \mathtt{edu1} + \beta_3 \mathtt{edu2} + \beta_4 \mathtt{age \times edu1} + \beta_5 \mathtt{age \times edu2}$
::: 
{
  "hash": "53965da3dcfda85e036b5baa5c1638c1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Model Assessment\"\nsubtitle: \"Logistic regression -- Stat 230\"\nformat: \n  revealjs:\n    chalkboard: \n      buttons: false\neditor: source\n---\n\n\n\n\n## Revisiting the Framingham model\n\n- Y = CHD (0 = no, 1 = yes)\n\n- X = participant's age, sex, total cholesterol, and systolic blood pressure\n\n\n::: {.cell}\n\n:::\n\n\n\n## Model assumptions\n::: {.incremental}\n1. **Linearity:** there is a linear relationship between the log odds (logit) and the predictors\n\n2. **Independence:** no pairing, clustering, etc.\n\n3. **Randomness:** we have a random sample from the population or the data were collected from a randomized experiment\n:::\n\n# Residual analysis\n\n## Response residuals\n\n- $e_i = y_i - \\widehat{\\pi}_i = \\begin{cases} 1 - \\widehat{\\pi}_i & \\text{if } y_i = 1 \\\\ - \\widehat{\\pi}_i & \\text{if } y_i = 0 \\end{cases}$\n- Always be between -1 and 1\n\n. . .\n\n:::{.columns}\n:::{.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-2-1.png){width=100%}\n:::\n:::\n\n:::\n\n:::{.column width=\"50%\"}\n\n:::fragment\n- Not normally distributed\n:::\n\n:::fragment\n- True distribution under correct model is unknown\n:::\n:::\n:::\n\n\n\n\n## Binned residuals\n\n:::{style=\"font-size: 0.9em;\"}\n\n<!-- - It is not useful to plot the raw residuals, so we will examine binned residual plots -->\n\nGelman and Hill suggest binning (grouping) cases by a predictor and computing mean response residuals value within each group\n\n:::{.incremental}\n- Calculate response residuals\n\n- Order observations either by the values of the predicted log odds/probabilities, or by quantitative predictor variable\n\n- Use the ordered data to create $g$ bins of approximately equal size.<br> (Default value: $g = \\sqrt{n}$)\n\n- Calculate average residual value in each bin\n\n- Plot average residuals vs. average predicted log odds, probability, or predictor value\n:::\n\n:::\n\n\n## Binned residuals\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-3-1.png){fig-align='center' width=95%}\n:::\n:::\n\n\n\n## Binned residuals\n\n\n- Nonlinear trend may be indication that squared term or log transformation of predictor variable required\n\n:::{.fragment}\n- If bins have large average residuals (in magnitude)\n\n    + Look at averages of other predictor variables across bins\n\n    + Interaction may be required if large magnitude residuals correspond to certain combinations of predictor variables\n:::\n\n## Binned residuals\n\n\n::: {.cell layout-ncol=\"2\"}\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-4-1.png){width=360}\n:::\n\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-4-2.png){width=360}\n:::\n\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-4-3.png){width=360}\n:::\n:::\n\n\n\n## Residuals vs. categorical predictor\n\n- Calculate average residual for each level of the predictor\n\n- All the means should close to 0\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n| male| average residual|\n|----:|----------------:|\n|    0|        -8.88e-13|\n|    1|        -3.51e-13|\n\n\n:::\n:::\n\n\n\n## Pearson residuals\n\nStandardize the distance between the observation (0 or 1)\nand the expected value (probability)\n\n$$r_{p_i} = \\dfrac{y_i - \\widehat{\\pi}_i}{\\sqrt{\\widehat{\\pi}_i (1 - \\widehat{\\pi}_i)}}$$\n\n## Pearson residuals vs. $\\widehat{\\eta}$ or $\\widehat{\\pi}$\n\n\n:::{style=\"font-size: 0.8em;\"}\n- If the model is correct, then the expected (average) Pearson residual within each bin should be close to 0\n\n- A smoother should be approximately horizontal line with intercept 0\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nresidualPlot(heart_mod, type = \"pearson\", smooth = TRUE)\n```\n\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=60%}\n:::\n:::\n\n\n\n##\n\n19 of these residual plots were created (simulated) from a model we know is correct, and one is from our actual data\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n\n##\n\nSmoothers can help draw attention to major flaws, but there will always be\nvariation from the horizontal!\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=768}\n:::\n:::\n\n\n\n## Framingham model Pearson residuals\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-9-1.png){width=720}\n:::\n:::\n\n\n# Checking linearity is hard!\n\n\n## Empirical logit\n\n*Toy example:* Our $x$ values are all unique and range from 2-20. Let's\ndivide the $n=7$ cases into four groups according to their $x$ value:\n$$[0,5], (5-10], (10-15], (15-20]$$\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-10-1.png){fig-align='center' width=384}\n:::\n:::\n\n\n\n## Empirical logit\n\n**For each group, compute the empirical probability and odds of success**\n\nAdd 0.5 a success and failure to each group to eliminate computational problems\nwhen we see 0 S or F in a group.\n\n$\\widehat{p} = \\dfrac{\\text{# successes in bin} + 0.5}{\\text{# cases in bin} + 1}$\n\n$\\widehat{\\omega} = \\dfrac{\\widehat{p}}{1-\\widehat{p}}= \\dfrac{\\text{# successes in bin} + 0.5}{\\text{# failures in bin} + 0.5}$\n\n<br>\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> bin </td>\n   <td style=\"text-align:left;\"> [0,5] </td>\n   <td style=\"text-align:left;\"> (5-10] </td>\n   <td style=\"text-align:left;\"> (10-15] </td>\n   <td style=\"text-align:left;\"> (15-20] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> emp.prob </td>\n   <td style=\"text-align:left;\"> 0.625 </td>\n   <td style=\"text-align:left;\"> 0.750 </td>\n   <td style=\"text-align:left;\"> 0.500 </td>\n   <td style=\"text-align:left;\"> 0.250 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> emp.odds </td>\n   <td style=\"text-align:left;\"> 1.6666667 </td>\n   <td style=\"text-align:left;\"> 3.0000000 </td>\n   <td style=\"text-align:left;\"> 1.0000000 </td>\n   <td style=\"text-align:left;\"> 0.3333333 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n## Empirical logit plots\n\n**Plot the empirical log odds vs. midpoint for each bin.**\n\nfor linearity, strength, direction, curvature, etc.\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-12-1.png){fig-align='center' width=50%}\n:::\n:::\n\n\n\n- It’s hard to see a trend (whether good or bad) with only 4 bins!\n\n\n## Setting the bin width\n\n**Target:** relatively constant probability/odds of success within each\ngroup *and* enough cases in each group to estimate prob/odds\n\n-  Bins that are too wide (e.g. too few bins) means this assumption is likely not met\n\n-  Bins that are too narrow (e.g. too many bins) means that we don’t have enough cases\nwithin each bin to accurately estimate the probability/odds of success.\n\n\n\n## Back to the heart study\n\n\n\n::: {.cell layout-ncol=\"3\"}\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-13-1.png){width=288}\n:::\n\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-13-2.png){width=288}\n:::\n\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-13-3.png){width=288}\n:::\n:::\n\n\n\n\n\n\n## Case influence\n\nWe can still calculate and interpret leverage and Cook's distance as before\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](16-logistic-diagnostics_files/figure-revealjs/unnamed-chunk-14-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
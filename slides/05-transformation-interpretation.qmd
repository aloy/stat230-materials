---
geometry: margin = 1in
output: pdf_document
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
library(tidyverse)
library(ggformula)
library(ggdist)
library(distributional)
set.seed(2142)
```


# Summary: Interpretation of slope under log transformations

## log-transform Y only

$\mu \lbrace \log(Y) | x \rbrace = \beta_0 + \beta_1x$

$$
\frac{\text{median of } Y | x+1}{\text{median of } Y | x} = \frac{e^{\beta_0 + \beta_1 (x+1)}}{e^{\beta_0 + \beta_1 x}} = e^{\beta_1}
$$

The median of $Y$ at $x + 1$ is $e^\beta_1$ times larger (smaller) than the median of $Y$ at $x$. Increasing $x$ by 1 increases (decreases) the median of $Y$ by a factor of $e^\beta_1$.

## log-transform x only

$\mu \lbrace Y | x \rbrace = \beta_0 + \beta_1 \log(x)$

Double x: $\mu \lbrace Y | 2x \rbrace - \mu \lbrace Y | x \rbrace = \beta_1 \log(2)$
 
A doubling of $x$ is associated with the mean response ($Y$) increasing (decreasing) by $\beta_1 \log(2)$ units.

Note that you can use other multiplicative factors other than a doubling. For instance, if you want $x$ to increase by a factor of 1.25 (that is, a 25% increase), then a similar derivation would yield

$\mu \lbrace Y | 1.25x \rbrace - \mu \lbrace Y | x \rbrace = \beta_1 \log(1.25)$

Increasing $x$ by 25% results in the mean of $Y$ increasing (decreasing) by $\beta_1 \log(1.25)$ units.


## log-transform both Y and x

$\mu \lbrace \log(Y) | x \rbrace = \beta_0 + \beta_1 \log(x)$

$$
\frac{\text{median of } Y | 2x}{\text{median of } Y | x} = e^{\beta_1 \log(2)} = 2^{\beta_1}
$$

The median of $Y$ at $2x$ is $e^{\beta_1 \log(2)}$ times greater (smaller) than the median of $Y$ at $x$. Or equivalently, a doubling of x is associated with the median of Y increasing (decreasing) by a factor of $e^{\beta_1 \log(2)}$.

As above, you can use other multiplicative factors other than a doubling. For a 25% increase,

$$
\frac{\text{median of } Y | 1.25x}{\text{median of } Y | x} = e^{\beta_1 \log(1.25)} = 1.25^{\beta_1}
$$


## Remarks

1.  Multiplicative changes can also be stated in terms of percentage increases/decreases.


- **Ex. 1** The median of Y at 2x is 1.83 times greater than the median of Y at x.

    $(1.83 - 1) \times 100\% = 83\%$

    A doubling of x is associated with an 83\% increase in the median of Y .


- **Ex. 2** The median of Y at 2x is 0.75 times smaller than the median of Y at x.


    $(0.75 - 1) \times 100\% = -25\%$

    A doubling of x is associated with a 25\% decrease in the median of Y


2. As noted above, when your explanatory variable is logged, instead of "doubling x," you can use other multiplicative factors.

- **Ex. 3** $\hat{\mu} \lbrace Y | x \rbrace = 1.4 + 3.1 \log(x)$

    Suppose you want to consider a 10\% increase in x, so this corresponds to a factor of $0.10 + 1 = 1.10$.

    $3.1 \log(1.1) = 0.297$

    A 10\% increase in x is associated with the mean of Y increasing by about 0.3 units. (Note: this is an additive increase in the mean of Y ).


- **Ex. 4** $\hat{\mu} \lbrace \log(Y) | x \rbrace = -0.54 - 1.8 \log(x)$

    Suppose you want to consider a 30\% increase in x. This corresponds to a multiplicative change of $0.30 + 1 = 1.30$. That is, going from x to 1.3x.

    $e^{-1.8 \log(1.3)} = 1.3^{-1.8} = 0.6236$.

    A 30\% increase in x is associated with the median of Y decreasing by a factor of 0.624. 

    A 30\% increase in x is associated with the median of Y decreasing by about 38\%. $(0.624-1) \times 100\%$.


## Why the median?
After fitting the transformed model, our regression line gives predictions for the mean of $\log(Y)$ for a given value of $x$, which we denote $\mu\lbrace\log(Y) | x\rbrace$. A sketch of what this model looks like is shown below. Notice that on the log scale, the regression line describes the center (the mean) of a symmetric distribution around the regression line.


```{r}
#| echo: false
#| warning: false
#| fig-asp: 0.6
#| fig-height: 3

x <- rep(seq(2, 10, by = 2), each = 20)
y <- rlnorm(length(x), meanlog = 1 + 0.15 * x, sdlog = 0.3)
mod <- lm(log(y) ~ x)
slab_df <- data.frame(x = seq(2, 10, by = 2), 
                      yhat = predict(mod, newdata = data.frame(x = seq(2, 10, by = 2))),
                      resid_sd = 0.3)

gf_lm(log(y) ~ x,  data.frame(x, y = y), color = "#009E73") +
        stat_slab(aes(x = x, ydist = "norm", arg1 = yhat, arg2 = 0.3), data = slab_df,
                  alpha = 0.4, inherit.aes = FALSE, scale = 0.6, fill = "#E69F00") +
  theme_classic()
```

When we exponentiate to move back to the original scale we "distort" the model. The plot below shows the back-transformed version of the previous plot. Notice that the distributions are no longer symmetric. What was the mean on the log scale corresponds to the median on the original scale. 

```{r}
#| echo: false
#| fig-asp: 0.6
#| fig-height: 3
gf_lm(y ~ x,  data.frame(x, y), formula = log(y) ~ x, backtrans = exp, color = "#009E73") +
  stat_slab(aes(x = x, ydist = "lnorm", arg1 = yhat, arg2 = 0.3), data = slab_df,
            alpha = 0.4, inherit.aes = FALSE, scale = 0.6, fill = "#E69F00") +
    theme_classic()
```


On the univariate scale, consider the following example:

```{r}
#| echo: false
#| fig-asp: 0.6
#| fig-height: 3

ys <- rlnorm(1000, meanlog = 0, sdlog = 0.6)
h1 <- gf_histogram(~ys, bins = 50) +
annotate("text", x = 6, y = 150, label = paste("mean(y) =", round(mean(ys), 2)), color = "black") +
  annotate("text", x = 6, y = 140, label = paste("median(y) =", round(median(ys), 2)), color = "black") +
scale_y_continuous(expand = c(0, 0)) +
theme_classic() +
labs(x = "y", title = "Original scale")

logys <- log(ys)
h2 <- gf_histogram(~logys, bins = 50) +
annotate("text", x = 1, y = 80, label = paste("mean(log(y)) =", round(mean(logys), 3)), color = "black") +
theme_classic() + 
scale_y_continuous(expand = c(0, 0), limits = c(0, 90)) +
labs(x = "log(y)", title = "Log scale")

library(patchwork)
h1 + h2 + plot_layout(ncol = 2)
```

Now let's back transform and move back to the original scale from the log scale. Back-transforming the mean of log(y) gives us $e^{0.004}=1.004$, which is much closer to the median of y than to the mean.
